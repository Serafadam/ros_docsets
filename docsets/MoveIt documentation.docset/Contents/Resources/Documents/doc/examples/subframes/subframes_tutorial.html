<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subframes &mdash; MoveIt documentation  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/override.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="canonical" href="https://moveit.picknik.ai/rolling/doc/examples/subframes/subframes_tutorial.html" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="MoveItCpp Tutorial" href="../moveit_cpp/moveitcpp_tutorial.html" />
    <link rel="prev" title="MoveIt Deep Grasps" href="../moveit_deep_grasps/moveit_deep_grasps_tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/rolling-small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../examples.html#movegroup-ros-wrappers-in-c">MoveGroup - ROS Wrappers in C++</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../examples.html#using-moveit-directly-through-the-c-api">Using MoveIt Directly Through the C++ API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html">Robot Model and Robot State</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene/planning_scene_tutorial.html">Planning Scene</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_monitor/planning_scene_monitor_tutorial.html">Planning Scene Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html">Planning Scene ROS API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../motion_planning_api/motion_planning_api_tutorial.html">Motion Planning API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../motion_planning_pipeline/motion_planning_pipeline_tutorial.html">Motion Planning Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../creating_moveit_plugins/plugin_tutorial.html">Creating MoveIt Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visualizing_collisions/visualizing_collisions_tutorial.html">Visualizing Collisions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../time_parameterization/time_parameterization_tutorial.html">Time Parameterization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_with_approximated_constraint_manifolds/planning_with_approximated_constraint_manifolds_tutorial.html">Planning with Approximated Constraint Manifolds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pick_place/pick_place_tutorial.html">Pick and Place</a></li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_grasps/moveit_grasps_tutorial.html">MoveIt Grasps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_deep_grasps/moveit_deep_grasps_tutorial.html">MoveIt Deep Grasps</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Subframes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-the-demo">Running The Demo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-code">The Code</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#defining-two-collisionobjects-with-subframes">Defining two CollisionObjects with subframes</a></li>
<li class="toctree-l5"><a class="reference internal" href="#creating-the-planning-request">Creating the planning request</a></li>
<li class="toctree-l5"><a class="reference internal" href="#preparing-the-scene">Preparing the scene</a></li>
<li class="toctree-l5"><a class="reference internal" href="#interactively-testing-the-robot">Interactively testing the robot</a></li>
<li class="toctree-l5"><a class="reference internal" href="#setting-the-orientation">Setting the orientation</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#technical-notes">Technical notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualizing-subframes">Visualizing subframes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html">MoveItCpp Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bullet_collision_checker/bullet_collision_checker.html">Using Bullet for Collision Checking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mobile_base_arm/mobile_base_arm_tutorial.html">Planning For Differential-Drive Mobile Base and an Arm</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#integration-with-a-new-robot">Integration with a New Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to_guides/how_to_guides.html">How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to_contribute/how_to_contribute.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MoveIt documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples</a></li>
      <li class="breadcrumb-item active">Subframes</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ros-planning/moveit2_tutorials/blob/main/doc/examples/subframes/subframes_tutorial.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             


  <div class="section" id="subframes">
<h1>Subframes<a class="headerlink" href="#subframes" title="Permalink to this headline"></a></h1>
<p>Subframes are frames that are defined on <a class="reference external" href="http://docs.ros.org/api/moveit_msgs/html/msg/CollisionObject.html">CollisionObjects</a>.
They can be used to define points of interest on objects that you place in the scene, such as
the opening of a bottle, the the tip of a screwdriver, or the head of a screw.
They can be used for planning and to write robot instructions such as “<em>pick up the bottle, then
move the opening under the spout of the tap</em>”, or “<em>pick up the screwdriver, then place it above
the head of the screw</em>”.</p>
<p>Writing code that focuses on the object that the robot manipulates is not only
more readable, but also more robust and portable between robots. This tutorial shows you how to
define subframes on collision objects, publish them to the planning scene and use them to plan motions,
so you can do things like this:</p>
<a class="reference internal image-reference" href="../../../_images/subframes_tutorial_cylinder_demo.gif"><img alt="../../../_images/subframes_tutorial_cylinder_demo.gif" class="align-center" src="../../../_images/subframes_tutorial_cylinder_demo.gif" style="width: 450px;" /></a>
<p>In this animation, the robot moves the tip of the cylinder to different positions on the box.</p>
<div class="section" id="running-the-demo">
<h2>Running The Demo<a class="headerlink" href="#running-the-demo" title="Permalink to this headline"></a></h2>
<p>After having completed the steps in <a class="reference internal" href="../../tutorials/getting_started/getting_started.html"><span class="doc">Getting Started</span></a>, open two terminals. In the first terminal, execute this command to load up a panda, and wait for everything to finish loading:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roslaunch</span> <span class="n">panda_moveit_config</span> <span class="n">demo</span><span class="o">.</span><span class="n">launch</span>
</pre></div>
</div>
<p>In the second terminal run the tutorial:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rosrun</span> <span class="n">moveit_tutorials</span> <span class="n">subframes_tutorial</span>
</pre></div>
</div>
<p>In this terminal you should be able to enter numbers from 1-12 to send commands, and to see how the robot and the scene react.</p>
</div>
<div class="section" id="the-code">
<h2>The Code<a class="headerlink" href="#the-code" title="Permalink to this headline"></a></h2>
<p>The code for this example can be seen <a class="reference external" href="https://github.com/ros-planning/moveit2_tutorials/blob/main/doc/examples/subframes">here</a> in the moveit_tutorials GitHub project and is explained in detail below.</p>
<p>The code spawns a box and a cylinder in the planning scene, attaches the cylinder to the
robot, and then lets you send motion commands via the command line. It also defines two
convenience functions for sending a motion command, and for publishing the objects.</p>
<div class="section" id="defining-two-collisionobjects-with-subframes">
<h3>Defining two CollisionObjects with subframes<a class="headerlink" href="#defining-two-collisionobjects-with-subframes" title="Permalink to this headline"></a></h3>
<p>This helper function creates two objects and publishes them to the PlanningScene: a box and a cylinder.
The box spawns in front of the gripper, the cylinder at the tip of the gripper, as if it had been grasped.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">spawnCollisionObjects</span><span class="p">(</span><span class="n">moveit</span><span class="o">::</span><span class="n">planning_interface</span><span class="o">::</span><span class="n">PlanningSceneInterface</span><span class="o">&amp;</span><span class="w"> </span><span class="n">planning_scene_interface</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">z_offset_box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">.25</span><span class="p">;</span><span class="w">  </span><span class="c1">// The z-axis points away from the gripper</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">z_offset_cylinder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">.1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>First, we start defining the <a class="reference external" href="http://docs.ros.org/api/moveit_msgs/html/msg/CollisionObject.html">CollisionObject</a>
as usual.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">moveit_msgs</span><span class="o">::</span><span class="n">CollisionObject</span><span class="w"> </span><span class="n">box</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;box&quot;</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;panda_hand&quot;</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">primitives</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">primitive_poses</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">primitives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">box</span><span class="p">.</span><span class="n">primitives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">BOX</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">primitives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dimensions</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">primitives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">primitives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">primitives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.02</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">primitive_poses</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z_offset_box</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Then, we define the subframes of the CollisionObject. The subframes are defined in the <code class="docutils literal notranslate"><span class="pre">frame_id</span></code> coordinate
system, just like the shapes that make up the object. Each subframe consists of a name and a pose.
In this tutorial, we set the orientation of the subframes so that the z-axis of the subframe
points away from the object.
This is not strictly necessary, but it is helpful to follow a convention, and it avoids confusion when
setting the orientation of the target pose later on.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">subframe_names</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">subframe_poses</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="n">box</span><span class="p">.</span><span class="n">subframe_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bottom&quot;</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">subframe_poses</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-.05</span><span class="p">;</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">subframe_poses</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z_offset_box</span><span class="p">;</span><span class="w"></span>

<span class="n">tf2</span><span class="o">::</span><span class="n">Quaternion</span><span class="w"> </span><span class="n">orientation</span><span class="p">;</span><span class="w"></span>
<span class="n">orientation</span><span class="p">.</span><span class="n">setRPY</span><span class="p">(</span><span class="mf">90.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="n">box</span><span class="p">.</span><span class="n">subframe_poses</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">orientation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tf2</span><span class="o">::</span><span class="n">toMsg</span><span class="p">(</span><span class="n">orientation</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Lastly, the objects are published to the PlanningScene. In this tutorial, we publish a box and a cylinder.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">box</span><span class="p">.</span><span class="n">operation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">moveit_msgs</span><span class="o">::</span><span class="n">CollisionObject</span><span class="o">::</span><span class="n">ADD</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">cylinder</span><span class="p">.</span><span class="n">operation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">moveit_msgs</span><span class="o">::</span><span class="n">CollisionObject</span><span class="o">::</span><span class="n">ADD</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">planning_scene_interface</span><span class="p">.</span><span class="n">applyCollisionObjects</span><span class="p">({</span><span class="w"> </span><span class="n">box</span><span class="p">,</span><span class="w"> </span><span class="n">cylinder</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="creating-the-planning-request">
<h3>Creating the planning request<a class="headerlink" href="#creating-the-planning-request" title="Permalink to this headline"></a></h3>
<p>In this tutorial, we use a small helper function to create our planning requests and move the robot.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">moveToCartPose</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">PoseStamped</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pose</span><span class="p">,</span><span class="w"> </span><span class="n">moveit</span><span class="o">::</span><span class="n">planning_interface</span><span class="o">::</span><span class="n">MoveGroupInterface</span><span class="o">&amp;</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">end_effector_link</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
</pre></div>
</div>
<p>To use subframes of objects that are attached to the robot in planning, you need to set the end effector of your
move_group to the subframe of the object. The format has to be <code class="docutils literal notranslate"><span class="pre">object_name/subframe_name</span></code>, as shown
in the “<em>Example 1</em>” line.
Do not forget to reset your end_effector_link to a robot link when you detach your object, and the subframe
is not part of your robot anymore!</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">group</span><span class="p">.</span><span class="n">clearPoseTargets</span><span class="p">();</span><span class="w"></span>
<span class="n">group</span><span class="p">.</span><span class="n">setEndEffectorLink</span><span class="p">(</span><span class="n">end_effector_link</span><span class="p">);</span><span class="w"></span>
<span class="cm">/*</span>
<span class="cm">group.setEndEffectorLink(&quot;cylinder/tip&quot;);    // Example 1</span>
<span class="cm">group.setEndEffectorLink(&quot;panda_hand&quot;);      // Example 2</span>
<span class="cm">*/</span><span class="w"></span>
<span class="n">group</span><span class="p">.</span><span class="n">setStartStateToCurrentState</span><span class="p">();</span><span class="w"></span>
<span class="n">group</span><span class="p">.</span><span class="n">setPoseTarget</span><span class="p">(</span><span class="n">pose</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The rest of the planning is done as usual. Naturally, you can also use the <code class="docutils literal notranslate"><span class="pre">go()</span></code> command instead of
<code class="docutils literal notranslate"><span class="pre">plan()</span></code> and <code class="docutils literal notranslate"><span class="pre">execute()</span></code>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">ROS_INFO_STREAM</span><span class="p">(</span><span class="s">&quot;Planning motion to pose:&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">ROS_INFO_STREAM</span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">moveit</span><span class="o">::</span><span class="n">planning_interface</span><span class="o">::</span><span class="n">MoveGroupInterface</span><span class="o">::</span><span class="n">Plan</span><span class="w"> </span><span class="n">myplan</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">group</span><span class="p">.</span><span class="n">plan</span><span class="p">(</span><span class="n">myplan</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">group</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">myplan</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">ROS_WARN</span><span class="p">(</span><span class="s">&quot;Failed to perform motion.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="preparing-the-scene">
<h3>Preparing the scene<a class="headerlink" href="#preparing-the-scene" title="Permalink to this headline"></a></h3>
<p>In the main function, we first spawn the objects in the planning scene, then attach the cylinder to the robot.
Attaching the cylinder turns it purple in Rviz.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">spawnCollisionObjects</span><span class="p">(</span><span class="n">planning_scene_interface</span><span class="p">);</span><span class="w"></span>
<span class="n">moveit_msgs</span><span class="o">::</span><span class="n">AttachedCollisionObject</span><span class="w"> </span><span class="n">att_coll_object</span><span class="p">;</span><span class="w"></span>
<span class="n">att_coll_object</span><span class="p">.</span><span class="n">object</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cylinder&quot;</span><span class="p">;</span><span class="w"></span>
<span class="n">att_coll_object</span><span class="p">.</span><span class="n">link_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;panda_hand&quot;</span><span class="p">;</span><span class="w"></span>
<span class="n">att_coll_object</span><span class="p">.</span><span class="n">object</span><span class="p">.</span><span class="n">operation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">att_coll_object</span><span class="p">.</span><span class="n">object</span><span class="p">.</span><span class="n">ADD</span><span class="p">;</span><span class="w"></span>
<span class="n">ROS_INFO_STREAM</span><span class="p">(</span><span class="s">&quot;Attaching cylinder to robot.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">planning_scene_interface</span><span class="p">.</span><span class="n">applyAttachedCollisionObject</span><span class="p">(</span><span class="n">att_coll_object</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="interactively-testing-the-robot">
<h3>Interactively testing the robot<a class="headerlink" href="#interactively-testing-the-robot" title="Permalink to this headline"></a></h3>
<p>We set up a small command line interface so you can interact with the simulation and see how it responds to certain
commands. You can use it to experiment with the behavior of the robot when you remove the box and cylinder, respawn
and reattach them, or create new planning requests. Try moving the robot into a new position and respawn the box
and cylinder there (they are spawned relative to the robot wrist).
Or try commands 7 and 8 to move different frames to the same position in space.</p>
<p>The command “2” moves the cylinder tip to the top of the box (the right side in the top animation).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">character_input</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">ROS_INFO_STREAM</span><span class="p">(</span><span class="s">&quot;Moving to top of box with cylinder tip&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">target_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;box/top&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">target_orientation</span><span class="p">.</span><span class="n">setRPY</span><span class="p">(</span><span class="mf">180.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">90.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tf2</span><span class="o">::</span><span class="n">toMsg</span><span class="p">(</span><span class="n">target_orientation</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">showFrames</span><span class="p">(</span><span class="n">target_pose</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cylinder/tip&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">moveToCartPose</span><span class="p">(</span><span class="n">target_pose</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cylinder/tip&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="setting-the-orientation">
<h3>Setting the orientation<a class="headerlink" href="#setting-the-orientation" title="Permalink to this headline"></a></h3>
<p>The target pose is given relative to a box subframe:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">target_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;box/bottom&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The orientation is determined by RPY angles to align the cylinder and box subframes:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">target_orientation</span><span class="p">.</span><span class="n">setRPY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">180.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="p">,</span><span class="w"> </span><span class="mf">90.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="p">);</span><span class="w"></span>
<span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tf2</span><span class="o">::</span><span class="n">toMsg</span><span class="p">(</span><span class="n">target_orientation</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>To keep some distance to the box, we use a small offset:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span><span class="w"></span>
<span class="n">showFrames</span><span class="p">(</span><span class="n">target_pose</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cylinder/tip&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">moveToCartPose</span><span class="p">(</span><span class="n">target_pose</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cylinder/tip&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="technical-notes">
<h2>Technical notes<a class="headerlink" href="#technical-notes" title="Permalink to this headline"></a></h2>
<p>Subframes are not known to TF, so they cannot be used outside of MoveIt planning requests.
If you need the transformation to a subframe, you can obtain it from the <code class="docutils literal notranslate"><span class="pre">PlanningScene</span></code>’s
<code class="docutils literal notranslate"><span class="pre">CollisionRobot</span></code> using the <code class="docutils literal notranslate"><span class="pre">getFrameTransform</span></code> function. This returns an <code class="docutils literal notranslate"><span class="pre">Eigen::Isometry3d</span></code> object,
from which you can extract translation and quaternion (see <a class="reference external" href="https://eigen.tuxfamily.org/dox/group__TutorialGeometry.html">here</a>).
The translation and quaternion can then be used to create the Transform and register it in your <code class="docutils literal notranslate"><span class="pre">TFListener</span></code>.</p>
</div>
<div class="section" id="visualizing-subframes">
<h2>Visualizing subframes<a class="headerlink" href="#visualizing-subframes" title="Permalink to this headline"></a></h2>
<p>There is currently no visualization for subframes, but pull requests for this feature are welcome!</p>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"></a></h2>
<p>For older moveit_config packages that you have not generated yourself recently, the planning adapter
required for subframes might not be configured, and the subframe link might not be found. To fix this for your
moveit_config package, open the <code class="docutils literal notranslate"><span class="pre">ompl_planning_pipeline.launch</span></code> file in the <code class="docutils literal notranslate"><span class="pre">&lt;robot_moveit_config&gt;/launch</span></code>
folder of your robot. For the Panda robot it is <a class="reference external" href="https://github.com/ros-planning/panda_moveit_config/blob/melodic-devel/launch/ompl_planning_pipeline.launch.xml">this</a> file.
Edit this launch file, find the lines where <code class="docutils literal notranslate"><span class="pre">&lt;arg</span> <span class="pre">name=&quot;planning_adapters&quot;&gt;</span></code> is mentioned and insert <code class="docutils literal notranslate"><span class="pre">default_planner_request_adapters/ResolveConstraintFrames</span></code> after
the line <code class="docutils literal notranslate"><span class="pre">default_planner_request_adapters/FixStartStatePathConstraints</span></code>.</p>
</div>
</div>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../moveit_deep_grasps/moveit_deep_grasps_tutorial.html" class="btn btn-neutral float-left" title="MoveIt Deep Grasps" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../moveit_cpp/moveitcpp_tutorial.html" class="btn btn-neutral float-right" title="MoveItCpp Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, PickNik Robotics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-108532843-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-108532843-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>