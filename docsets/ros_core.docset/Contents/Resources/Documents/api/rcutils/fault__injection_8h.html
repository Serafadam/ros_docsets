<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rcutils: include/rcutils/testing/fault_injection.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">rcutils
   &#160;<span id="projectnumber">master</span>
   </div>
   <div id="projectbrief">C API providing common utilities and data structures.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_6627b286d46f7ece855f6fbde3556e48.html">rcutils</a></li><li class="navelem"><a class="el" href="dir_274b5ddd58d7697346404fbad64ee573.html">testing</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">fault_injection.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &quot;<a class="el" href="macros_8h_source.html">rcutils/macros.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="visibility__control_8h_source.html">rcutils/visibility_control.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for fault_injection.h:</div>
<div class="dyncontent">
<div class="center"><img src="fault__injection_8h__incl.png" border="0" usemap="#ainclude_2rcutils_2testing_2fault__injection_8h" alt=""/></div>
<map name="ainclude_2rcutils_2testing_2fault__injection_8h" id="ainclude_2rcutils_2testing_2fault__injection_8h">
<area shape="rect" title=" " alt="" coords="219,5,381,47"/>
<area shape="rect" title=" " alt="" coords="5,102,88,129"/>
<area shape="rect" title=" " alt="" coords="112,102,179,129"/>
<area shape="rect" title=" " alt="" coords="203,102,274,129"/>
<area shape="rect" href="macros_8h.html" title=" " alt="" coords="298,102,425,129"/>
<area shape="rect" href="visibility__control_8h.html" title=" " alt="" coords="449,95,572,136"/>
<area shape="rect" href="visibility__control__macros_8h.html" title=" " alt="" coords="440,184,581,225"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="fault__injection_8h__dep__incl.png" border="0" usemap="#ainclude_2rcutils_2testing_2fault__injection_8hdep" alt=""/></div>
<map name="ainclude_2rcutils_2testing_2fault__injection_8hdep" id="ainclude_2rcutils_2testing_2fault__injection_8hdep">
<area shape="rect" title=" " alt="" coords="1375,5,1537,47"/>
<area shape="rect" href="error__handling_8h.html" title=" " alt="" coords="2091,244,2239,285"/>
<area shape="rect" href="macros_8h.html" title=" " alt="" coords="1367,95,1545,121"/>
<area shape="rect" href="logging_8h.html" title=" " alt="" coords="1210,572,1387,599"/>
<area shape="rect" href="string__array_8h.html" title=" " alt="" coords="1926,333,2079,375"/>
<area shape="rect" href="logging__macros_8h.html" title=" " alt="" coords="1216,647,1381,688"/>
<area shape="rect" href="types_8h.html" title=" " alt="" coords="1395,423,1560,449"/>
<area shape="rect" href="find_8h.html" title=" " alt="" coords="1321,497,1474,524"/>
<area shape="rect" href="split_8h.html" title=" " alt="" coords="1099,497,1256,524"/>
<area shape="rect" href="time_8h.html" title=" " alt="" coords="1498,497,1657,524"/>
<area shape="rect" href="allocator_8h.html" title=" " alt="" coords="1046,169,1231,196"/>
<area shape="rect" href="filesystem_8h.html" title=" " alt="" coords="43,251,240,278"/>
<area shape="rect" href="format__string_8h.html" title=" " alt="" coords="265,244,426,285"/>
<area shape="rect" href="process_8h.html" title=" " alt="" coords="451,251,629,278"/>
<area shape="rect" href="repl__str_8h.html" title=" " alt="" coords="654,244,797,285"/>
<area shape="rect" href="shared__library_8h.html" title=" " alt="" coords="821,244,982,285"/>
<area shape="rect" href="strdup_8h.html" title=" " alt="" coords="1795,251,1965,278"/>
<area shape="rect" href="array__list_8h.html" title=" " alt="" coords="1617,244,1770,285"/>
<area shape="rect" href="hash__map_8h.html" title=" " alt="" coords="1210,244,1363,285"/>
<area shape="rect" href="string__map_8h.html" title=" " alt="" coords="1439,244,1593,285"/>
<area shape="rect" href="env_8h.html" title=" " alt="" coords="2365,169,2517,196"/>
<area shape="rect" href="qsort_8h.html" title=" " alt="" coords="1824,169,1987,196"/>
<area shape="rect" href="snprintf_8h.html" title=" " alt="" coords="2061,169,2240,196"/>
<area shape="rect" href="strcasecmp_8h.html" title=" " alt="" coords="1595,169,1799,196"/>
<area shape="rect" href="char__array_8h.html" title=" " alt="" coords="1286,333,1439,375"/>
<area shape="rect" href="uint8__array_8h.html" title=" " alt="" coords="1109,333,1262,375"/>
<area shape="rect" href="get__env_8h.html" title=" " alt="" coords="2372,244,2511,285"/>
</map>
</div>
</div>
<p><a href="fault__injection_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a9be415886b878c1f50bb39ff8fd831f8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fault__injection_8h.html#a9be415886b878c1f50bb39ff8fd831f8">RCUTILS_FAULT_INJECTION_NEVER_FAIL</a>&#160;&#160;&#160;-1</td></tr>
<tr class="separator:a9be415886b878c1f50bb39ff8fd831f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3483964f16256ce7f497c5df2ae56b11"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fault__injection_8h.html#a3483964f16256ce7f497c5df2ae56b11">RCUTILS_FAULT_INJECTION_FAIL_NOW</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a3483964f16256ce7f497c5df2ae56b11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7894c16978b88b20c6a3983487dbaefb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fault__injection_8h.html#a7894c16978b88b20c6a3983487dbaefb">RCUTILS_FAULT_INJECTION_MAYBE_RETURN_ERROR</a>(return_value_on_error)</td></tr>
<tr class="memdesc:a7894c16978b88b20c6a3983487dbaefb"><td class="mdescLeft">&#160;</td><td class="mdescRight">This macro checks and decrements a static global variable atomic counter and returns <code>return_value_on_error</code> if 0.  <a href="fault__injection_8h.html#a7894c16978b88b20c6a3983487dbaefb">More...</a><br /></td></tr>
<tr class="separator:a7894c16978b88b20c6a3983487dbaefb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a308d22a420af93664515141f4783a9f9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fault__injection_8h.html#a308d22a420af93664515141f4783a9f9">RCUTILS_FAULT_INJECTION_MAYBE_FAIL</a>(failure_code)</td></tr>
<tr class="memdesc:a308d22a420af93664515141f4783a9f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">This macro checks and decrements a static global variable atomic counter and executes <code>failure_code</code> if the counter is 0 inside a scoped block (any variables declared in failure_code) will not be avaliable outside of this scoped block.  <a href="fault__injection_8h.html#a308d22a420af93664515141f4783a9f9">More...</a><br /></td></tr>
<tr class="separator:a308d22a420af93664515141f4783a9f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a0981ee39afd28abc57fe098f7c2f44"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fault__injection_8h.html#a9a0981ee39afd28abc57fe098f7c2f44">RCUTILS_FAULT_INJECTION_TEST</a>(code)</td></tr>
<tr class="separator:a9a0981ee39afd28abc57fe098f7c2f44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af14a5b235001cda34fedc2bb7d8ffcaa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fault__injection_8h.html#af14a5b235001cda34fedc2bb7d8ffcaa">RCUTILS_NO_FAULT_INJECTION</a>(code)</td></tr>
<tr class="separator:af14a5b235001cda34fedc2bb7d8ffcaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a262400c302115f9a27e9f33892980e01"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fault__injection_8h.html#a262400c302115f9a27e9f33892980e01">rcutils_fault_injection_is_test_complete</a> (void)</td></tr>
<tr class="separator:a262400c302115f9a27e9f33892980e01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1785cb949b4d7af67805bbc8c649babb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fault__injection_8h.html#a1785cb949b4d7af67805bbc8c649babb">rcutils_fault_injection_set_count</a> (int_least64_t count)</td></tr>
<tr class="memdesc:a1785cb949b4d7af67805bbc8c649babb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Atomically set the fault injection counter.  <a href="fault__injection_8h.html#a1785cb949b4d7af67805bbc8c649babb">More...</a><br /></td></tr>
<tr class="separator:a1785cb949b4d7af67805bbc8c649babb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2497ed2e5e0998f37923549e3f430572"><td class="memItemLeft" align="right" valign="top">int_least64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fault__injection_8h.html#a2497ed2e5e0998f37923549e3f430572">rcutils_fault_injection_get_count</a> (void)</td></tr>
<tr class="memdesc:a2497ed2e5e0998f37923549e3f430572"><td class="mdescLeft">&#160;</td><td class="mdescRight">Atomically get the fault injection counter value.  <a href="fault__injection_8h.html#a2497ed2e5e0998f37923549e3f430572">More...</a><br /></td></tr>
<tr class="separator:a2497ed2e5e0998f37923549e3f430572"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6f2c41b343f1a23cf0d1bd163573a6b"><td class="memItemLeft" align="right" valign="top">int_least64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fault__injection_8h.html#ac6f2c41b343f1a23cf0d1bd163573a6b">_rcutils_fault_injection_maybe_fail</a> (void)</td></tr>
<tr class="memdesc:ac6f2c41b343f1a23cf0d1bd163573a6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implementation of fault injection decrementer.  <a href="fault__injection_8h.html#ac6f2c41b343f1a23cf0d1bd163573a6b">More...</a><br /></td></tr>
<tr class="separator:ac6f2c41b343f1a23cf0d1bd163573a6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a9be415886b878c1f50bb39ff8fd831f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9be415886b878c1f50bb39ff8fd831f8">&#9670;&nbsp;</a></span>RCUTILS_FAULT_INJECTION_NEVER_FAIL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RCUTILS_FAULT_INJECTION_NEVER_FAIL&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3483964f16256ce7f497c5df2ae56b11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3483964f16256ce7f497c5df2ae56b11">&#9670;&nbsp;</a></span>RCUTILS_FAULT_INJECTION_FAIL_NOW</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RCUTILS_FAULT_INJECTION_FAIL_NOW&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7894c16978b88b20c6a3983487dbaefb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7894c16978b88b20c6a3983487dbaefb">&#9670;&nbsp;</a></span>RCUTILS_FAULT_INJECTION_MAYBE_RETURN_ERROR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RCUTILS_FAULT_INJECTION_MAYBE_RETURN_ERROR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">return_value_on_error</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="fault__injection_8h.html#a3483964f16256ce7f497c5df2ae56b11">RCUTILS_FAULT_INJECTION_FAIL_NOW</a> == <a class="code" href="fault__injection_8h.html#ac6f2c41b343f1a23cf0d1bd163573a6b">_rcutils_fault_injection_maybe_fail</a>()) { \</div>
<div class="line">    printf( \</div>
<div class="line">      <span class="stringliteral">&quot;%s:%d Injecting fault and returning &quot;</span> #return_value_on_error <span class="stringliteral">&quot;\n&quot;</span>, __FILE__, __LINE__); \</div>
<div class="line">    return return_value_on_error; \</div>
<div class="line">  }</div>
<div class="ttc" id="afault__injection_8h_html_a3483964f16256ce7f497c5df2ae56b11"><div class="ttname"><a href="fault__injection_8h.html#a3483964f16256ce7f497c5df2ae56b11">RCUTILS_FAULT_INJECTION_FAIL_NOW</a></div><div class="ttdeci">#define RCUTILS_FAULT_INJECTION_FAIL_NOW</div><div class="ttdef"><b>Definition:</b> fault_injection.h:31</div></div>
<div class="ttc" id="afault__injection_8h_html_ac6f2c41b343f1a23cf0d1bd163573a6b"><div class="ttname"><a href="fault__injection_8h.html#ac6f2c41b343f1a23cf0d1bd163573a6b">_rcutils_fault_injection_maybe_fail</a></div><div class="ttdeci">int_least64_t _rcutils_fault_injection_maybe_fail(void)</div><div class="ttdoc">Implementation of fault injection decrementer.</div></div>
</div><!-- fragment -->
<p>This macro checks and decrements a static global variable atomic counter and returns <code>return_value_on_error</code> if 0. </p>
<p>This macro is not a function itself, so when this macro returns it will cause the calling function to return with the return value.</p>
<p>Set the counter with <code>RCUTILS_FAULT_INJECTION_SET_COUNT</code>. If the count is less than 0, then <code>RCUTILS_FAULT_INJECTION_MAYBE_RETURN_ERROR</code> will not cause an early return.</p>
<p>This macro is thread-safe, and ensures that at most one invocation results in a failure for each time the fault injection counter is set with <code>RCUTILS_FAULT_INJECTION_SET_COUNT</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">return_value_on_error</td><td>the value to return in the case of fault injected failure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a308d22a420af93664515141f4783a9f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a308d22a420af93664515141f4783a9f9">&#9670;&nbsp;</a></span>RCUTILS_FAULT_INJECTION_MAYBE_FAIL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RCUTILS_FAULT_INJECTION_MAYBE_FAIL</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">failure_code</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="fault__injection_8h.html#a3483964f16256ce7f497c5df2ae56b11">RCUTILS_FAULT_INJECTION_FAIL_NOW</a> == <a class="code" href="fault__injection_8h.html#ac6f2c41b343f1a23cf0d1bd163573a6b">_rcutils_fault_injection_maybe_fail</a>()) { \</div>
<div class="line">    printf( \</div>
<div class="line">      <span class="stringliteral">&quot;%s:%d Injecting fault and executing &quot;</span> #failure_code <span class="stringliteral">&quot;\n&quot;</span>, __FILE__, __LINE__); \</div>
<div class="line">    failure_code; \</div>
<div class="line">  }</div>
</div><!-- fragment -->
<p>This macro checks and decrements a static global variable atomic counter and executes <code>failure_code</code> if the counter is 0 inside a scoped block (any variables declared in failure_code) will not be avaliable outside of this scoped block. </p>
<p>This macro is not a function itself, so it will cause the calling function to execute the code from within an if loop.</p>
<p>Set the counter with <code>RCUTILS_FAULT_INJECTION_SET_COUNT</code>. If the count is less than 0, then <code>RCUTILS_FAULT_INJECTION_MAYBE_FAIL</code> will not execute the failure code.</p>
<p>This macro is thread-safe, and ensures that at most one invocation results in a failure for each time the fault injection counter is set with <code>RCUTILS_FAULT_INJECTION_SET_COUNT</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">failure_code</td><td>the code to execute in the case of fault injected failure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9a0981ee39afd28abc57fe098f7c2f44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a0981ee39afd28abc57fe098f7c2f44">&#9670;&nbsp;</a></span>RCUTILS_FAULT_INJECTION_TEST</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RCUTILS_FAULT_INJECTION_TEST</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">code</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">do</span> { \</div>
<div class="line">    int fault_injection_count = 0; \</div>
<div class="line">    do { \</div>
<div class="line">      rcutils_fault_injection_set_count(fault_injection_count++); \</div>
<div class="line">      code; \</div>
<div class="line">    } <span class="keywordflow">while</span> (!<a class="code" href="fault__injection_8h.html#a262400c302115f9a27e9f33892980e01">rcutils_fault_injection_is_test_complete</a>()); \</div>
<div class="line">    rcutils_fault_injection_set_count(<a class="code" href="fault__injection_8h.html#a9be415886b878c1f50bb39ff8fd831f8">RCUTILS_FAULT_INJECTION_NEVER_FAIL</a>); \</div>
<div class="line">  } <span class="keywordflow">while</span> (0)</div>
<div class="ttc" id="afault__injection_8h_html_a262400c302115f9a27e9f33892980e01"><div class="ttname"><a href="fault__injection_8h.html#a262400c302115f9a27e9f33892980e01">rcutils_fault_injection_is_test_complete</a></div><div class="ttdeci">bool rcutils_fault_injection_is_test_complete(void)</div></div>
<div class="ttc" id="afault__injection_8h_html_a9be415886b878c1f50bb39ff8fd831f8"><div class="ttname"><a href="fault__injection_8h.html#a9be415886b878c1f50bb39ff8fd831f8">RCUTILS_FAULT_INJECTION_NEVER_FAIL</a></div><div class="ttdeci">#define RCUTILS_FAULT_INJECTION_NEVER_FAIL</div><div class="ttdef"><b>Definition:</b> fault_injection.h:29</div></div>
</div><!-- fragment --><p>The fault injection macro for use with unit tests to check that <code>code</code> can tolerate injected failures at all points along the execution path where the indicating macros <code>RCUTILS_CAN_RETURN_WITH_ERROR_OF</code> and <code>RCUTILS_CAN_FAIL_WITH</code> are located.</p>
<p>This macro is intended to be used within a gtest function macro like 'TEST', 'TEST_F', etc.</p>
<p><code>code</code> is executed within a do-while loop and therefore any variables declared within are in their own scope block.</p>
<p>Here's a simple example: RCUTILS_FAULT_INJECTION_TEST( rcl_ret_t ret = rcl_init(argc, argv, options, context); if (RCL_RET_OK == ret) { ret = rcl_shutdown(context); } });</p>
<p>In this example, you will need have conditional execution based on the return value of <code>rcl_init</code>. If it failed, then it wouldn't make sense to call rcl_shutdown. In your own test, there might be similar logic that requires conditional checks. The goal of writing this test is less about checking the behavior is consistent, but instead that failures do not cause program crashes, memory errors, or unnecessary memory leaks. </p>

</div>
</div>
<a id="af14a5b235001cda34fedc2bb7d8ffcaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af14a5b235001cda34fedc2bb7d8ffcaa">&#9670;&nbsp;</a></span>RCUTILS_NO_FAULT_INJECTION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RCUTILS_NO_FAULT_INJECTION</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">code</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">do</span> { \</div>
<div class="line">    int64_t no_fault_injection_count = <a class="code" href="fault__injection_8h.html#a2497ed2e5e0998f37923549e3f430572">rcutils_fault_injection_get_count</a>(); \</div>
<div class="line">    rcutils_fault_injection_set_count(<a class="code" href="fault__injection_8h.html#a9be415886b878c1f50bb39ff8fd831f8">RCUTILS_FAULT_INJECTION_NEVER_FAIL</a>); \</div>
<div class="line">    code; \</div>
<div class="line">    rcutils_fault_injection_set_count(no_fault_injection_count); \</div>
<div class="line">  } <span class="keywordflow">while</span> (0)</div>
<div class="ttc" id="afault__injection_8h_html_a2497ed2e5e0998f37923549e3f430572"><div class="ttname"><a href="fault__injection_8h.html#a2497ed2e5e0998f37923549e3f430572">rcutils_fault_injection_get_count</a></div><div class="ttdeci">int_least64_t rcutils_fault_injection_get_count(void)</div><div class="ttdoc">Atomically get the fault injection counter value.</div></div>
</div><!-- fragment --><p>A convenience macro built around <a class="el" href="fault__injection_8h.html#a1785cb949b4d7af67805bbc8c649babb" title="Atomically set the fault injection counter.">rcutils_fault_injection_set_count()</a> to pause fault injection during <code>code</code> execution. This macro is intended to be used within <a class="el" href="fault__injection_8h.html#a9a0981ee39afd28abc57fe098f7c2f44">RCUTILS_FAULT_INJECTION_TEST()</a> blocks.</p>
<p><code>code</code> is executed within a do-while loop and therefore any variables declared within are in their own scope block.</p>
<p>Here's a simple example: RCUTILS_FAULT_INJECTION_TEST({ rcl_ret_t ret = rcl_init(argc, argv, options, context); if (RCL_RET_OK == ret) { RCUTILS_NO_FAULT_INJECTION({ ret = rcl_shutdown(context); }); } });</p>
<p>In this example, on successful rcl_init(), rcl_shutdown() is called while ensuring that it will not fail due to fault injection. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a262400c302115f9a27e9f33892980e01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a262400c302115f9a27e9f33892980e01">&#9670;&nbsp;</a></span>rcutils_fault_injection_is_test_complete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool rcutils_fault_injection_is_test_complete </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1785cb949b4d7af67805bbc8c649babb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1785cb949b4d7af67805bbc8c649babb">&#9670;&nbsp;</a></span>rcutils_fault_injection_set_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rcutils_fault_injection_set_count </td>
          <td>(</td>
          <td class="paramtype">int_least64_t&#160;</td>
          <td class="paramname"><em>count</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Atomically set the fault injection counter. </p>
<p>This is typically not the preferred method of interacting directly with the fault injection logic, instead use <code>RCUTILS_FAULT_INJECTION_TEST</code> instead.</p>
<p>This function may also be used for pausing code inside of a <code>RCUTILS_FAULT_INJECTION_TEST</code> with something like the following:</p>
<p>RCUTILS_FAULT_INJECTION_TEST({ ... // code to run with fault injection int64_t count = <a class="el" href="fault__injection_8h.html#a2497ed2e5e0998f37923549e3f430572" title="Atomically get the fault injection counter value.">rcutils_fault_injection_get_count()</a>; rcutils_fault_injection_set_count(RCUTILS_FAULT_INJECTION_NEVER_FAIL); ... // code to run without fault injection rcutils_fault_injection_set_count(count); ... // code to run with fault injection });</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">count</td><td>The count to set the fault injection counter to. If count is negative, then fault injection errors will be disabled. The counter is globally initialized to RCUTILS_FAULT_INJECTION_NEVER_FAIL. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a2497ed2e5e0998f37923549e3f430572"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2497ed2e5e0998f37923549e3f430572">&#9670;&nbsp;</a></span>rcutils_fault_injection_get_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int_least64_t rcutils_fault_injection_get_count </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Atomically get the fault injection counter value. </p>
<p>This function is typically not used directly but instead indirectly inside an <code>RCUTILS_FAULT_INJECTION_TEST</code> </p>

</div>
</div>
<a id="ac6f2c41b343f1a23cf0d1bd163573a6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6f2c41b343f1a23cf0d1bd163573a6b">&#9670;&nbsp;</a></span>_rcutils_fault_injection_maybe_fail()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int_least64_t _rcutils_fault_injection_maybe_fail </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implementation of fault injection decrementer. </p>
<p>This is included inside of macros, so it needs to be exported as a public function, but it should not be used directly. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
